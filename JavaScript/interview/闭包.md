## 定义

闭包就是内部函数，我们可以通过在一个 `函数内部` 或者 `{}块` 里面定义一个函数来创建闭包。



## 词法作用域

词法作用域是指内部函数在定义的时候就决定了其外部作用域。



```js
(function autorun(){
    let x = 1
    function log(){
      console.log(x)
    }
    
    function run(fn){
      let x = 100
      fn()
    }
    
    run(log) // 1
})()
```

`log()` 函数是一个闭包，它在这里访问的是 `autorun()` 函数中的 `x` 变量，而不是 `run` 函数中的变量。因为闭包的外部作用域是在其定义的时候已决定，而不是执行的时候。

`autorun()` 的函数作用域即是 `log()` 函数的词法作用域。



## 作用域链

每一个作用域都有对其父作用域的引用。当我们使用一个变量的时候，`Javascript引擎` 会通过变量名在当前作用域查找，若没有查找到，会一直沿着作用域链一直向上查找，直到 `global` 全局作用域。



当外部作用域执行完毕后，内部函数还存活（仍在其他地方被引用）时，闭包才真正发挥其作用。譬如以下几种情况：

- 在异步任务例如 `timer` 定时器，事件处理，`Ajax` 请求中被作为回调
- 被外部函数作为返回结果返回，或者返回结果对象中引用该内部函数



变量的生命周期取决于闭包的生命周期。被闭包引用的外部作用域中的变量将一直存活直到闭包函数被销毁。如果一个变量被多个闭包所引用，那么直到所有的闭包被垃圾回收后，该变量才会被销毁。



除了 `timer` 定时器，事件处理，`Ajax` 请求等比较常见的异步任务，还有其他的一些异步 `API` 比如 `HTML5 Geolocation`，`WebSockets` , `requestAnimationFrame()`也将使用到闭包的这一特性。

